@model RealEstateApp.Application.ViewModels.Properties.PropertyUpdateViewModel

@{
    ViewData["Title"] = "Editar Propiedad";
}

<title>Editar Propiedad</title>

<div class="container my-5">
    <h1 class="text-center mb-4">Editar Propiedad</h1>
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Mensaje de error si faltan datos clave -->
            @if (!Model.PropertyTypes!.Any() || !Model.SaleTypes!.Any() || !Model.Improvements!.Any())
            {
                <div class="alert alert-danger">
                    <strong>No es posible editar la propiedad.</strong> Asegúrate de que existan tipos de propiedades, tipos de ventas y mejoras configuradas en el sistema.
                </div>
                <a href="#" class="btn btn-primary mb-4">Volver</a>
            }
            else
            {
                <form asp-action="EditProperties" asp-controller="Properties" method="post" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="PropertyTypeId">Tipo de Propiedad</label>
                        <select asp-for="PropertyTypeId" asp-items="Model.PropertyTypes" class="form-control"></select>
                        <span asp-validation-for="PropertyTypeId" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label for="SaleTypeId">Tipo de Venta</label>
                        <select asp-for="SaleTypeId" asp-items="Model.SaleTypes" class="form-control"></select>
                        <span asp-validation-for="SaleTypeId" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label for="Price">Precio (RD$)</label>
                        <input asp-for="Price" class="form-control" />
                        <span asp-validation-for="Price" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label for="Size">Tamaño (m²)</label>
                        <input asp-for="Size" class="form-control" />
                        <span asp-validation-for="Size" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label for="Rooms">Habitaciones</label>
                        <input asp-for="Rooms" class="form-control" />
                        <span asp-validation-for="Rooms" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label for="Bathrooms">Baños</label>
                        <input asp-for="Bathrooms" class="form-control" />
                        <span asp-validation-for="Bathrooms" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label for="Description">Descripción</label>
                        <textarea asp-for="Description" class="form-control" rows="4"></textarea>
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label>Mejoras Disponibles</label>
                        <div class="form-check">
                            @foreach (var improvement in Model.Improvements!)
                            {
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="ImprovementIds" value="@improvement.Value" id="improvement-@improvement.Value"
                                           @if (Model.SelectedImprovementIds != null && Model.SelectedImprovementIds.Contains(int.Parse(improvement.Value))) { <text>checked</text> }>
                                    <label class="form-check-label" for="improvement-@improvement.Value">
                                        @improvement.Text
                                    </label>
                                </div>

                            }
                        </div>
                        <span asp-validation-for="ImprovementIds" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label for="Images">Imágenes</label>
                        <input asp-for="Images" type="file" class="form-control" multiple />
                        <small class="form-text text-muted">Puedes subir hasta 4 imágenes.</small>
                        <span asp-validation-for="Images" class="text-danger"></span>
                    </div>

                    @if (Model.Images.Any())
                    {
                        <div class="form-group">
                            <label>Imágenes actuales</label>
                            <div class="row">
                                @foreach (var image in Model.Images)
                                {
                                    <div class="col-md-3 mb-3">
                                        <img src="@image" alt="Imagen de propiedad" class="img-fluid" />
                                    </div>
                                }
                            </div>
                        </div>
                    }

                    <button type="submit" class="btn btn-primary btn-block mt-4">Guardar cambios</button>
                </form>
            }
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        @if (TempData["SuccessMessage"] != null)
        {
            <text>
                Swal.fire({
                    icon: 'success',
                    title: '¡Éxito!',
                    text: '@TempData["SuccessMessage"]',
                    showConfirmButton: true,
                    timer: 5000
                });
            </text>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <text>
                Swal.fire({
                    icon: 'error',
                    title: '¡Error!',
                    text: '@TempData["ErrorMessage"]',
                    showConfirmButton: true,
                    timer: 5000
                });
            </text>
        }
    </script>
</div>
